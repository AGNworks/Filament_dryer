const unsigned char LOGO_NA [] PROGMEM = {
// 'NA128_64', 128x64px
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xbe, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x00, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0xff, 0x00, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0x80, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xc0, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xbf, 0xe0, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xf0, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xf8, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xfc, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xfc, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xfe, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0x80, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0xc0, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0xc0, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0xe0, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xfb, 0xff, 0xf0, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf9, 0xff, 0xf8, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0xff, 0xfc, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x7f, 0xfc, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x3f, 0xfe, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x3f, 0xff, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x1f, 0xff, 0xbf, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x1f, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x0f, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x07, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x03, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x01, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xf8, 0x00, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xfc, 0x00, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xfc, 0x03, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xfc, 0x0f, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xfd, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xf8, 0x7f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xc0, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xf0, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0x80, 0x00, 0x3f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xfe, 0x00, 0x00, 0x0f, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


#include <Wire.h>
#include <OneWire.h>
#include <Adafruit_SSD1306.h>
#include <Adafruit_GFX.h>
#define OLED_ADDR   0x3C
#include <SPI.h>

#define SCREEN_WIDTH 128 // OLED display width, in pixels
#define SCREEN_HEIGHT 64 // OLED display height, in pixels
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);

#define TEMP_PIN A0

OneWire ds(TEMP_PIN);  
float temp, temp_pred;  
unsigned long lastUpdateTime = 0;   
const int TEMP_UPDATE_TIME = 5000;


unsigned long timer = 0;
unsigned long lastTimer = 0;

String material = "PLA";

int aState;
int aLastState;  

#define encoder0PinA  2
#define encoder0PinB  3
int encoder0Pos = 0;

#define button 9
#define vent_pin 6
#define relay_pin 11

int nstemp = 0;
int vremia = 0;
int hours = 0;
int minutes = 0;


byte lepes = 0;
byte clk;
byte menuCount = 1;
byte dir = 0;
bool runState = false;
bool heating =false;
bool getWarm = false;

bool selected = false; //gombnyomas ertekelese

byte page = 1;


//********************************************************************************************************************************************************Setup
void setup() 
{
  encoder0Pos = 1;
  
  Wire.begin();  
  pinMode(TEMP_PIN, INPUT);  
  
  pinMode(vent_pin, OUTPUT);
  pinMode(relay_pin, OUTPUT);
  
  pinMode(encoder0PinA, INPUT_PULLUP);
  pinMode(encoder0PinB, INPUT_PULLUP);
  pinMode(button, INPUT);

  digitalWrite(relay_pin, HIGH);
  delay(500);
  digitalWrite(relay_pin, LOW);
  
  attachInterrupt(0, EncoderCount, CHANGE);  // encoder pin on interrupt 0 - pin 2
  
  Serial.begin(9600);
  display.begin(SSD1306_SWITCHCAPVCC, OLED_ADDR);
  display.display();
  display.clearDisplay();
  
  display.drawBitmap(0, 0,  LOGO_NA, 128, 64, WHITE);
  display.display();
  delay(2000);
  display.clearDisplay();
  aLastState = digitalRead(encoder0PinA);  
}


//********************************************************************************************************************************************************LOOP
void loop() 
{

  detectTemperature();
  WarmControl();
  NagrevTimer();
  
  if (page == 1) 
  {
    menuCheck1();
    staticMenu();
  }
  
  if (page == 2) 
  {
    menuCheck2();
    page2();
  }
  
  if (page == 3) 
  {
    menuCheck3();
    page3();
  }
  
  display.clearDisplay();
  delay(100);
}

//********************************************************************************************************************************************************StaticMenu
void staticMenu() 
{
  display.setTextSize(1);
  display.setTextColor(WHITE);

  display.setCursor(10, 0);
  display.println("MANUAL");
  if (heating == true && runState == true)
  {
    display.setCursor(90, 0);
    display.println("ON");
  }
  if (heating == false || runState == false)
  {
    display.setCursor(90, 0);
    display.println("OFF");
  }
  //---------------------------------
  display.setTextSize(1);
  display.setCursor(10, 10);
  display.println("Tek Temp:");
  display.setCursor(80, 10);
  display.println(temp);

  display.setCursor(10, 20);
  display.println("Nastr Temp:");
  display.setCursor(80, 20);
  display.println(nstemp);

  display.setCursor(10, 30);
  display.println("Vremia:");
  
  hours = vremia / 60;
  minutes = vremia - (hours * 60);
  display.setCursor(55, 30);
  display.println(hours);
  display.setCursor(68, 30);
  display.println("h");
  display.setCursor(80, 30);
  display.println(minutes);
  display.setCursor(93, 30);
  display.println("min");

  display.setCursor(10, 40);
  display.println("Start:");
  display.setCursor(45, 40);
  
  ReadingButton();  
  if (menuCount == 3 && selected == true) 
  {
    while (selected == true){
      display.clearDisplay();
      display.setTextSize(1);
      display.setTextColor(WHITE);
      
      display.setCursor(10, 0);
      display.println("MANUAL");
      if (heating == true && runState == true)
      {
      display.setCursor(90, 0);
      display.println("ON");
      }
      if (heating == false || runState == false)
      {
      display.setCursor(90, 0);
      display.println("OFF");
      }
      //---------------------------------
      display.setTextSize(1);
      display.setCursor(10, 10);
      display.println("Tek Temp:");
      display.setCursor(80, 10);
      display.println(temp);
      
      display.setCursor(10, 20);
      display.println("Nastr Temp:");
      display.setCursor(80, 20);
      display.println(nstemp);
      
      display.setCursor(10, 30);
      display.println("Vremia:");
      
      hours = vremia / 60;
      minutes = vremia - (hours * 60);
      display.setCursor(55, 30);
      display.println(hours);
      display.setCursor(68, 30);
      display.println("h");
      display.setCursor(80, 30);
      display.println(minutes);
      display.setCursor(93, 30);
      display.println("min");
      
      display.setCursor(10, 40);
      display.println("Start:");
      display.setCursor(45, 40);
      
    display.println("Nagrev");
    runState = true;
    getWarm = true;

    detectTemperature();
    WarmControl();
    NagrevTimer();
    ReadingButton();
    display.display();
    }
    encoder0Pos=3;
  } 
  else 
  {
    display.println("Ozhidanie");
    runState = false;
    getWarm = false;
  }
  
  display.setCursor(10, 50);
  display.println("  Stran 1 ");
  display.setCursor(70, 50);
  
  ReadingButton();  
  if (menuCount == 4 && selected) //changing the screen to the next page
  {
    page = 2;
    menuCount = 1;
    encoder0Pos = 1;
    selected = false;
    
  } 
  else 
  {
    display.println("--> 2");
    page = 1;
  }
  
  display.setCursor(2, (menuCount * 10) + 10 );
  display.println(">");

  display.display();
}

//********************************************************************************************************************************************************page2
void page2()
{
  display.setTextSize(1);
  display.setTextColor(WHITE);

  display.setCursor(10, 0);
  display.println("PLA....45C 4h");
  
  display.setCursor(10, 10);
  display.println("ABS....60C 2h");
  
  display.setCursor(10, 20);
  display.println("PETG...65C 2h");
  
  display.setCursor(10, 30);
  display.println("NYLON..70C 12h");
  
  display.setCursor(10, 40);
  display.println("TPU....50C 4h");


  display.setCursor(10, 50);
  display.println("  1 <-- 2  Stran");
  display.setCursor(70, 50);
 
 if (selected && menuCount != 6) 
  {
    page = 3;
    menuCount = 1;
    encoder0Pos = 1;
    selected = false;
  } 
  
  ReadingButton();                  //getting back to page1
  if (selected && menuCount == 6) 
  {
    page = 1;
    menuCount = 1;
    encoder0Pos = 1;
    selected = false;
  } 

  
  display.setCursor(2, (menuCount * 10)-10);
  display.println(">");

  display.display();
}

//********************************************************************************************************************************************************page3
void page3() 
{
 
  
  display.setTextSize(1);
  display.setTextColor(WHITE);

  display.setCursor(10, 0);
  display.println(material);  //kiirjuk az aktualisan kivalasztott anyag tipusat
  
  if (heating == true && runState == true)
  {
    display.setCursor(100, 0);
    display.println("ON");
  }
  if (heating == false || runState == false)
  {
    display.setCursor(100, 0);
    display.println("OFF");
  }
  //---------------------------------
  display.setTextSize(1);
  display.setCursor(10, 10);
  display.println("Tek Temp:");
  display.setCursor(80, 10);
  display.println(temp);

  display.setCursor(10, 20);
  display.println("Nastr Temp:");
  display.setCursor(80, 20);
  display.println(nstemp);

  display.setCursor(10, 30);
  display.println("Vremia:");

  hours = vremia / 60;
  minutes = vremia - (hours * 60);
  display.setCursor(55, 30);
  display.println(hours);
  display.setCursor(68, 30);
  display.println("h");
  display.setCursor(80, 30);
  display.println(minutes);
  display.setCursor(93, 30);
  display.println("min");

  display.setCursor(10, 40);
  display.println("Start:");
  display.setCursor(45, 40);
  
  ReadingButton();  
  if (menuCount == 3 && selected == true) 
  {
    while (selected == true){
      display.clearDisplay();
      display.setTextSize(1);
      display.setTextColor(WHITE);
    
      display.setCursor(10, 0);
      display.println(material);  //kiirjuk az aktualisan kivalasztott anyag tipusat
      
      if (heating == true && runState == true)
      {
        display.setCursor(100, 0);
        display.println("ON");
      }
      if (heating == false || runState == false)
      {
        display.setCursor(100, 0);
        display.println("OFF");
      }
      //---------------------------------
      display.setTextSize(1);
      display.setCursor(10, 10);
      display.println("Tek Temp:");
      display.setCursor(80, 10);
      display.println(temp);
    
      display.setCursor(10, 20);
      display.println("Nastr Temp:");
      display.setCursor(80, 20);
      display.println(nstemp);
    
      display.setCursor(10, 30);
      display.println("Vremia:");
    
      hours = vremia / 60;
      minutes = vremia - (hours * 60);
      display.setCursor(55, 30);
      display.println(hours);
      display.setCursor(68, 30);
      display.println("h");
      display.setCursor(80, 30);
      display.println(minutes);
      display.setCursor(93, 30);
      display.println("min");
    
      display.setCursor(10, 40);
      display.println("Start:");
      display.setCursor(45, 40);
        
      display.println("Nagrev");
      runState = true;
      getWarm = true;
  
      detectTemperature();
      WarmControl();
      NagrevTimer();
      ReadingButton();
      display.display();
    }
    encoder0Pos = 3;
    menuCount = 3;
  } 
  else 
  {
    display.println("Ozhidanie");
    runState = false;
    getWarm = false;
  }
  
  display.setCursor(10, 50);
  display.println("  1 <-- 3  Stran");
  display.setCursor(70, 50);
  
  ReadingButton();  
  if (menuCount == 4 && selected) //changing the screen to the next page
  {
    display.println(" <--");
    page = 1;
    menuCount = 1;
    encoder0Pos = 1;
    selected = false;
    
  } 
  else 
  {
    display.println(" - ");
    page = 3;
  }
  
  display.setCursor(2, (menuCount * 10) + 10 );
  display.println(">");

  display.display();
}


//********************************************************************************************************************************************************MenuCheck1
void menuCheck1() 
{
  if (encoder0Pos < 5)   
  {
    menuCount = encoder0Pos;
  }
  
  if (encoder0Pos >= 4) 
  {
    encoder0Pos = 4;
    menuCount = encoder0Pos;
  }

  ReadingButton();
  if (menuCount == 1 && selected){
    encoder0Pos = nstemp;
    while(selected){
    if (encoder0Pos >= 0 && encoder0Pos <= 150 ){
     nstemp = encoder0Pos;
     display.clearDisplay();
     display.setCursor(10, 20);
     display.println("Nastr Temp:");
     display.setCursor(80, 20);
     display.println(nstemp);
     display.display();
    }
    else {nstemp = 0;
    encoder0Pos = 1;}
    ReadingButton();
    }
    encoder0Pos = 1;
    menuCount = 1; 
  }

  ReadingButton();
  if (menuCount == 2 && selected){
    encoder0Pos = vremia;
    while(selected){
    if (encoder0Pos >= 0){
    vremia = encoder0Pos;
    display.clearDisplay();
    display.setCursor(10, 30);
    display.println("Vremia:");
    
    hours = vremia / 60;
    minutes = vremia - (hours * 60);
    display.setCursor(55, 30);
    display.println(hours);
    display.setCursor(68, 30);
    display.println("h");
    display.setCursor(80, 30);
    display.println(minutes);
    display.setCursor(93, 30);
    display.println("min");
    display.display();
    }
    else {nstemp = 0;
    encoder0Pos = 1;}
    ReadingButton();
    }
    encoder0Pos = 2;
    menuCount = 2;  
  }
  

}

//********************************************************************************************************************************************************MenuCheck2
void menuCheck2() 
{
  if (encoder0Pos < 7)   //ha megnyomod a gombot lep egyet ezt kell atirni encoder tekeresre
  {
    menuCount = encoder0Pos;
  }
  
  if (encoder0Pos >= 6) 
  {
    encoder0Pos = 6;
    menuCount = encoder0Pos;
  }
  
  if (menuCount == 1)  //PLA
  {
    nstemp = 45;
    vremia = 240;
    material = "PLA";
  }
  if (menuCount == 2) //ABS
  {
    nstemp = 60;
    vremia = 120;
    material = "ABS";
  }
  if (menuCount == 3) //PETG
  {
    nstemp = 65;
    vremia = 120;
    material = "PETG";
  }
  if (menuCount == 4) //NYLON   
  {
    nstemp = 70;
    vremia = 720;
    material = "NYLON";
  }
  if (menuCount == 5) //TPU
  {
    nstemp = 50;
    vremia = 240;
    material = "TPU";
  }
   
}

//********************************************************************************************************************************************************MenuCheck3
void menuCheck3() 
{
  if (encoder0Pos < 5)   {
    menuCount = encoder0Pos;
  }
  
  if (encoder0Pos >= 4) {
    encoder0Pos = 4;
    menuCount = encoder0Pos;
  }
  if (menuCount != 3){
    selected = false;
  }
}


//********************************************************************************************************************************************************WarmControl
void WarmControl() 
{
  if (nstemp < temp)
   {
    getWarm = true;
   }
   
  if (runState == true) 
    {
      digitalWrite(vent_pin, HIGH);
      if (nstemp > temp)
         {
          digitalWrite(relay_pin, HIGH);
          heating = true;
         }
      else 
        {
          digitalWrite(relay_pin, LOW);
          heating = false;
        }
     }
     
  if (runState == false) 
  {
    digitalWrite(relay_pin, LOW);
    heating == false;
    if (temp < 30 )
     {
      digitalWrite(vent_pin, LOW);
     }
  } 
   
}

//********************************************************************************************************************************************************EncoderCount
void EncoderCount()
{
   aState = digitalRead(encoder0PinA); 
   if (aState != aLastState)
   {     
     if (digitalRead(encoder0PinB) != aState) 
     { 
      lepes ++;
      delayMicroseconds(300);
      if (lepes == 4)       //hany lepesenket emeli az encoder szamlalo erteket 
      {
       encoder0Pos ++;
       delayMicroseconds(500);
       lepes = 0;
      }
     } else {
       lepes ++;
       delayMicroseconds(300);
      if (lepes == 4)
      {
       if (encoder0Pos >= 2)
         {
          encoder0Pos --;
         }
       delayMicroseconds(500);
       lepes = 0;
      }
     }
   } 
   aLastState = aState;
   
}

//********************************************************************************************************************************************************ReadingButton
void ReadingButton()
{
 if (digitalRead(button)==HIGH && selected == false)
 {
  selected = true;
  delay(200);
 }
 
 if (digitalRead(button)==HIGH && selected == true)
 {
  selected = false;
  delay(200);
 }
}


//********************************************************************************************************************************************************detectTemperature
int detectTemperature(){
  byte data[2];
  ds.reset();
  ds.write(0xCC);
  ds.write(0x44);
  if ((abs(millis() - lastUpdateTime)) > TEMP_UPDATE_TIME) {
    lastUpdateTime = millis();
    ds.reset();
    ds.write(0xCC);
    ds.write(0xBE);
 
    data[0] = ds.read(); 
    data[1] = ds.read(); 
   
    temp_pred = temp; 
    temp =  ((data[1] << 8) | data[0]) * 0.0625;
  }
}


//********************************************************************************************************************************************************NagrevTimer
void NagrevTimer()
{
  if (runState == true && vremia != 0 && getWarm == true)
   {
    if (millis() - timer >= 60000)
     {
      timer = millis();
      vremia = vremia - 1 ;
      
     }
   }  
  if (vremia == 0 && runState == true)
  {
    runState = false;
    getWarm = false;
    encoder0Pos = 0;
  }
   
}
